<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×ª×–×›×•×¨×•×ª ×ª×©×œ×•× - ×”×ª×¨××•×ª</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ×¢×™×¦×•×‘ ×¡×¤×¦×™×¤×™ ×œ×›×¤×ª×•×¨×™× ×‘×ª×•×š ×”×”×ª×¨××” */
        .alert-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end; /* ×™×™×©×•×¨ ×œ×™××™×Ÿ */
        }
        .alert-actions button {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 0;
            transition: opacity 0.3s;
        }
        .delete-btn {
            background-color: #c62828; /* ××“×•× ×›×”×” */
        }
        .delete-btn:hover {
            background-color: #b71c1c;
        }
        .done-btn {
            background-color: #1976D2; /* ×›×—×•×œ */
        }
        .done-btn:hover {
            background-color: #1565C0;
        }
        /* ×”×ª×××” ×©×œ ××‘× ×” ×”×”×ª×¨××” ×›×“×™ ×œ×”×›×™×œ ××ª ×”×›×¤×ª×•×¨×™× */
        .alert-item {
            flex-direction: column;
            align-items: flex-start;
        }
        .alert-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>×”×ª×¨××•×ª ×ª×©×œ×•× ×œ×”×™×•×: <span id="currentDate"></span></h1>
        
        <div id="alertsContainer">
            </div>

        <a href="index.html">×—×–×¨×” ×œ×”×–× ×ª ×œ×§×•×—×•×ª</a>
        <button onclick="checkAlerts()">×¨×¢× ×Ÿ ×‘×“×™×§×ª ×”×ª×¨××•×ª</button>
    </div>

    <script>
        // *** ×¤×•× ×§×¦×™×•×ª ×”×˜×™×¤×•×œ ×‘× ×ª×•× ×™× ***

        // ×¤×•× ×§×¦×™×” ×œ×©××™×¨×ª ×¨×©×™××ª ×”×œ×§×•×—×•×ª ×”××¢×•×“×›× ×ª
        function saveClients(clients) {
            localStorage.setItem('monthlyClients', JSON.stringify(clients));
        }

        // ×¤×•× ×§×¦×™×” ×œ××—×™×§×ª ×œ×§×•×— ×œ×¦××™×ª×•×ª
        function deleteClient(nameToDelete) {
            if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×œ×§×•×— ${nameToDelete} ×œ×¦××™×ª×•×ª?`)) {
                return;
            }

            const clientsJson = localStorage.getItem('monthlyClients');
            const clients = clientsJson ? JSON.parse(clientsJson) : [];

            // ×¡×™× ×•×Ÿ ×”×œ×§×•×— ×©×¦×¨×™×š ×œ××—×•×§
            const updatedClients = clients.filter(client => client.name !== nameToDelete);

            saveClients(updatedClients);
            alert(`×”×œ×§×•×— ${nameToDelete} × ××—×§ ×œ×¦××™×ª×•×ª.`);
            checkAlerts(); // ×¨×¢× ×Ÿ ××ª ×”×ª×¦×•×’×”
        }

        // ×¤×•× ×§×¦×™×” ×œ×¡×™××•×Ÿ ×›"×˜×•×¤×œ ×”×—×•×“×©"
        function markAsDone(nameToMark) {
            const todayDate = new Date().toISOString().split('T')[0]; // ×¤×•×¨××˜: YYYY-MM-DD
            const clientsJson = localStorage.getItem('monthlyClients');
            let clients = clientsJson ? JSON.parse(clientsJson) : [];

            // ××¦×™××ª ×”×œ×§×•×— ×•×¢×“×›×•×Ÿ ×©×“×” lastReminderDate
            clients = clients.map(client => {
                if (client.name === nameToMark) {
                    return { ...client, lastReminderDate: todayDate };
                }
                return client;
            });

            saveClients(clients);
            alert(`×”×œ×§×•×— ${nameToMark} ×¡×•××Ÿ ×›×˜×•×¤×œ ×œ×—×•×“×© ×–×”.`);
            checkAlerts(); // ×¨×¢× ×Ÿ ××ª ×”×ª×¦×•×’×”
        }

        // *** ×¤×•× ×§×¦×™×” ×¨××©×™×ª ×œ×‘×“×™×§×” ×•×”×¦×’×” ***
        function checkAlerts() {
            const today = new Date();
            const todayDayOfMonth = today.getDate(); 
            // ×¤×•×¨××˜: YYYY-MM-DD ×©×œ ×ª×—×™×œ×ª ×”×—×•×“×© ×”× ×•×›×—×™
            const startOfCurrentMonth = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];

            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = ''; 
            
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('he-IL', dateOptions);

            const clientsJson = localStorage.getItem('monthlyClients');
            const clients = clientsJson ? JSON.parse(clientsJson) : [];
            let alertsFound = false;

            clients.forEach(client => {
                const isPaymentDay = client.day === todayDayOfMonth;
                
                // ×‘×“×™×§×” ×× ×¡×•××Ÿ ×›×˜×•×¤×œ ×”×—×•×“×©:
                // 1. ×§×™×™× ×©×“×” lastReminderDate
                // 2. ×”×ª××¨×™×š ×”××—×¨×•×Ÿ ×©×¡×•××Ÿ ×’×“×•×œ ××• ×©×•×•×” ×œ×ª×—×™×œ×ª ×”×—×•×“×© ×”× ×•×›×—×™ (×›×œ×•××¨, ×˜×•×¤×œ ×”×—×•×“×©)
                const isMarkedDoneThisMonth = client.lastReminderDate && client.lastReminderDate >= startOfCurrentMonth;

                // ×”×¦×’ ×”×ª×¨××” ×¨×§ ×× ×–×” ×™×•× ×”×ª×©×œ×•× *×•×œ×* ×¡×•××Ÿ ×›×˜×•×¤×œ ×”×—×•×“×©
                if (isPaymentDay && !isMarkedDoneThisMonth) {
                    alertsFound = true;
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert-item';
                    alertDiv.innerHTML = `
                        <div class="alert-header">
                            <div class="alert-details">
                                <strong>×ª×–×›×•×¨×ª ×“×—×•×¤×”!</strong> ×™×© ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×œ×§×•×—: 
                                <span style="font-weight:bold; font-size:1.2em;">${client.name}</span>
                            </div>
                        </div>
                        <div class="alert-time">
                            ×™×•× ×ª×©×œ×•× ×—×•×“×©×™: ${client.day} | ×©×¢×” ××•××œ×¦×ª: ${client.time}
                        </div>
                        <div class="alert-actions">
                            <button class="done-btn" onclick="markAsDone('${client.name}')">×”×–×›×¨×ª×™ ×”×—×•×“×© âœ…</button>
                            <button class="delete-btn" onclick="deleteClient('${client.name}')">××—×§ ×”×ª×¨××” ×œ×ª××™×“ ğŸ—‘ï¸</button>
                        </div>
                    `;
                    alertsContainer.appendChild(alertDiv);
                }
            });

            if (!alertsFound) {
                alertsContainer.innerHTML = '<div class="no-alerts">ğŸ‰ ××™×Ÿ ×ª×–×›×•×¨×•×ª ×ª×©×œ×•× ×¤×¢×™×œ×•×ª ×œ×”×™×•×. ğŸ‰</div>';
            }
        }

        // ×”×¤×¢×œ×ª ×”×‘×“×™×§×” ××™×“ ×œ××—×¨ ×˜×¢×™× ×ª ×”×“×£
        checkAlerts();
    </script>
</body>
</html>
